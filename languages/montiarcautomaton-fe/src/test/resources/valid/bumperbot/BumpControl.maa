package valid.bumperbot;

import valid.bumperbot.datatypes.MotorCommand;
import valid.bumperbot.datatypes.TimerSignal;
import valid.bumperbot.datatypes.TimerCmd;

component BumpControl {
  port
    in Double distance,
    in TimerSignal signal,
    out TimerCmd timer,
    out MotorCommand right,
    out MotorCommand left;

  implementation BumpControl {
  automaton BumpControl {
    state Idle, Driving, Backing, Turning;

    initial Idle / {right = MotorCommand.STOP, left = MotorCommand.STOP};

    Idle -> Driving [distance < 2] / {right = MotorCommand.FORWARD, left = MotorCommand.FORWARD};
    Driving -> Driving [distance >= 2] / {right = MotorCommand.FORWARD, left = MotorCommand.FORWARD};
    Driving -> Backing [distance < 2] / {right = MotorCommand.BACKWARD, left = MotorCommand.BACKWARD, timer = TimerCmd.DOUBLE};
    Backing -> Turning {signal == TimerSignal.ALERT} / {right = MotorCommand.FORWARD, timer = TimerCmd.SINGLE};
    Turning -> Driving {signal == TimerSignal.ALERT} / {left = MotorCommand.FORWARD, right = MotorCommand.FORWARD};
    }
  }
}