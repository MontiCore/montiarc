package a;

import components.body.subcomponents._subcomponents.HasGenericInputAndOutputPort;
import components.body.subcomponents._subcomponents.HasPortsOfHierachicalCDTypes;

/*
 * Invalid model.
 * The model has connectors which are not type compatible as specified below.
 *
 * Formerly named "R6" in MontiArc3.
 *
 * @implements [Hab16] R8: The target port in a connection has to be compatible
                             to the source port, i.e., the type of the target
                             port is identical or a supertype of the source
                             port type. (p.66, Lst. 3.43)
 * TODO Add Test
 * TODO Correct package: types or components.body.connectors?
 */
component ConnectsPortsWithIncompatibleTypes {
  port
    in Integer inInteger,
    in Integer inInteger2,
    out String outString,
    out String outString2;
  
  component components.body.subcomponents._subcomponents.HasStringInputAndIntegerOutput p1;
  component components.body.subcomponents._subcomponents.HasStringInputAndIntegerOutput p2;
  component components.body.subcomponents._subcomponents.IntegerInputAndBooleanOutput p3;
  
  component HasPortsOfHierachicalCDTypes p4;
  component HasPortsOfHierachicalCDTypes p5;
  
  component HasGenericInputAndOutputPort<String> p6;
  
  component HasGenericInputAndOutputPort<String> p7;

  component HasGenericInputAndOutputPort<Integer> p8;

  component HasGenericInputAndOutputPort<String> p9;
  
  // correct
  connect p4.subTypeOut -> p5.superTypeIn;
    // correct String -> String
  connect p6.tOut -> outString2;
  // correct Integer -> Integer
  connect inInteger2 -> p9.tIn;  
  
  
  connect p1.outString -> outString; 
      // ERROR: The types 'java.lang.Integer' and 'java.lang.String' 
      // from the ports in the connector 'p1.outString -> outString' 
      // are not compatible!
  
  connect inInteger -> p1.inInteger; 
      // ERROR: The types 'java.lang.Integer' and 'java.lang.String' 
      // from the ports in the connector 'inInteger -> p1.inInteger'
      // are not compatible!
  
  connect inInteger2 -> p6.tIn; 
      // ERROR: The types 'java.lang.Integer' and 'java.lang.String' 
      // from the ports in the connector 'inInteger2 -> p6.tIn' 
      // are not compatible!
  
  connect p3.Boolean -> p2.inInteger; 
      // ERROR: The types 'java.lang.Boolean' and 'java.lang.String' 
      // from the ports in the connector 'p3.Boolean -> p2.inInteger' 
      // are not compatible!
  
  connect p4.superTypeOut -> p5.subTypeIn; 
      // ERROR: The types 'TypesWithHierarchy.SuperType' and 'TypesWithHierarchy.SubType'
      // from the ports in the connector 'p4.superTypeOut -> p5.subTypeIn' 
      // are not compatible!
  
  connect p7.tOut -> p8.tIn;
      // ERROR: The types 'java.lang.String' and 'java.lang.Integer' 
      // from the ports in the connector 'p7.tOut -> p8.tIn' 
      // are not compatible!
}