package valid.bumperbot;

automaton BumpControl {
    input Double distance;
    input TimerSignal signal;
    output TimerCmd timer;
    output MotorCmd right;
    output MotorCmd left;
	   
    state Idle, Driving, Backing, Turning;

    initial Idle / {right = MotorCmd.STOP, left = MotorCmd.STOP};

    Idle -> Driving  / {right = MotorCmd.FORWARD, left = MotorCmd.FORWARD};
    Driving -> Backing [distance < 5] / {right = MotorCmd.BACKWARD, left = MotorCmd.BACKWARD, timer = TimerCmd.SINGLE};
    Backing -> Turning {signal == TimerSignal.ALERT} / {right = MotorCmd.BACKWARD, left = MotorCmd.FORWARD, timer = TimerCmd.DOUBLE};
    Turning -> Driving {signal == TimerSignal.ALERT} / {left = MotorCmd.FORWARD, right = MotorCmd.FORWARD};
}